---
name: market-microstructure
description: |
  거래량 분석, 정보 비대칭, 가격 발견(price discovery), 시장 참여자 행동 분석,
  이상 거래량 탐지, ARCH/GARCH 변동성 모델링, 허딩 효과 분석,
  또는 "왜 거래가 일어나는가?" 관련 질문 시 활성화된다.
  단순 가격 추세 분석이나 포트폴리오 구성 작업에는 활성화하지 않는다.
version: 1.0.0
---

# 시장 미시구조 프레임워크

## 핵심 명제: 거래량이 먼저다

> "이걸 알 수 있는 방법은 가격이 아니라 거래량이다"

```
Volume = Private Information Extraction Score

거래량 급증 신호:
  20일 이동평균 대비 오늘 거래량 3배 or 5배 이상
  → 새로운 정보가 시장에 들어왔다는 신호

확인해야 하는 3가지:
  1. 정보가 좋은지 / 나쁜지 (방향)
  2. 영향력이 단기인지 / 장기인지 (지속성)
  3. 잡음(노이즈)인지 여부
```

**두 가지 해석 시나리오:**
- 거래량 폭증 = 새 정보 유입 (정보 보유자가 막 행동 시작)
- 거래량 폭증 = 고점 신호 (정보 보유자가 이미 행동 완료, 청산 중)
- → 가격 방향과 함께 판단 필수

---

## Rational Expectations와 거래의 역설

**핵심 질문:**
> "만약 모든 투자자가 동일한 정보를 가지면, 왜 거래가 이루어지나?"

```
Rational Expectation: 모든 이용가능한 정보 사용
→ 균형에서는 거래 동기가 없어야 함
But 실제로는 거래 발생 → 이유: Heterogeneous Expectations
```

**Heterogeneous Agents:**
- 거래량 증가 = 미래에 대한 기대가 다르다는 것
- 누군가는 팔고, 누군가는 산다 = 정보/해석의 차이
- 외국인이 삼성을 7만원에 매수 → 균형가격이 9만원인 걸 알기 때문 (정보 우위)

---

## ARCH 모델: 변동성의 시간 구조

```
어제의 변동성이 오늘의 변동성에 영향

ARCH: Auto Regressive Conditional Heteroskedasticity
  → 분산(리스크)에 시간 차원을 도입한 최초 방식
  → 다이나믹한 리스크: 정적 σ가 아닌 σ(t)

Yt = a·Yt-1 + εt
σt² = α₀ + α₁·εt-1²  (ARCH(1))
```

**실무 적용:**
- VaR 계산 시 ARCH 계열 사용 → 더 정확한 꼬리 리스크 추정
- 변동성이 낮은 구간 이후 변동성 급증 패턴 (변동성 클러스터링)

---

## 리스크 요인 분해 (실무)

```
개별 주식 리턴의 리스크 원천:

Index 리스크 (70-80%)
  → KOSPI, NASDAQ 등 국가/시장 인덱스
  → 인덱스 박스권 → 소형주 유리
  → 인덱스 상승 → 대형주(삼전, 하이닉스, ETF) 유리

Factor 리스크 (~20%)
  → PBR, 기업규모, EPS, 성장성
  → PBR 높은 기업 = 바이오/제조업 = 금리 민감

Macro 리스크 (나머지)
  → 거시경제 지표, 정책 변수 (Unit Root 주의)
```

---

## 허딩 효과

- 사람들은 왜 삼성전자를 좋아할까? → 사후적 설명만 가능, 사전 예측 어려움
- 가격 = 군중심리의 결과 → 진짜 균형가격이 아닐 수 있음
- 사람들은 자기 주장을 뒷받침하는 방향으로만 해석하는 경향

**대응:**
- ETF 수급(외국인/기관/개인 비율)으로 허딩 방향 파악
- 극단적 포지셔닝(AAII, COT 데이터) 역발상 신호

---

## 미래 예측의 3가지 레이어

```
1. 과거 통계 모형 (ARCH, ARIMA 등)      ← 데이터 기반
2. 산업적 변화 (기술 혁신, 구조 변화)    ← 섹터 분석
3. 경제학적 지식 (인과관계, 정책 효과)   ← 도메인 판단

→ 3가지를 동시에 고려해야 의미있는 예측
→ forecast는 반드시 경제학적 도메인에서 나와야 함
```

**기술적 분석(TA) 활용 기준:**
```python
# 피크-트로프 레이블링 (myTA.py 패턴)
# lag = period/2 윈도우로 로컬 고점/저점 탐지
# 매수=1 (로컬 저점), 매도=0 (로컬 고점), 보유=2

# 거래량 지표 우선순위
CMF (Chaikin Money Flow)  # 매집/분산 판단
MFI (Money Flow Index)    # 거래량 가중 RSI
Force Index               # 가격변화 × 거래량 = 힘
```

---

## 버블 탐지 프레임워크 (Greenwood, Shleifer & You 2019)

> **논문:** "Bubbles for Fama" — 파마의 효율시장 가설에 대한 실증적 응답

### 핵심 발견

**데이터:** 미국 49개 Fama-French 산업 포트폴리오 (1926~2014) + 국제 주식시장 (1985~2014)

**조작적 정의:** 2년 이내 100% 이상 상승 = "가격 급등(Price Run-up)"

| 발견 | 내용 |
|------|------|
| Finding A | 가격 급등만으로는 폭락 예측 불가 → 파마의 주장 부분 지지 |
| **Finding B** | **급등 + 고변동성 = 버블 → 향후 12개월 평균 -40% 폭락** |
| Finding C | 추가 버블 신호: 주식 대량 발행(IPO 급증), 극단적 거래량 |

### 합리적 붐 vs. 버블 구분표

| 특성 | 합리적 붐 | 버블 |
|------|-----------|------|
| 가격 상승 | 2년 100%+ | 2년 100%+ |
| 변동성 | **낮음/안정** | **높음/급등** |
| 주식 발행 | 보통 | IPO 급증 |
| 지배적 서사 | "펀더멘털 개선" | "이번엔 다르다" |
| 이후 12개월 | 양(+)/정상 | 음(-40%) |

### 조건부 효율성 (Conditional Efficiency)

```
핵심 명제:
  시장은 평상시 → 펀더멘털 반영 (효율적)
  고변동성 + 의견 불일치 극대화 시 → 펀더멘털과 디커플링

실무 적용:
  VIX > 25 + HY OAS > 500bp = 비효율 구간 진입 신호
  이 구간에서는 기술적 과매수/과매도 신호의 신뢰도 상승
```

**버블 사전 탐지 체크리스트:**
```
□ 2년 수익률 ≥ 100% ?
□ 변동성(σ)이 최근 5년 평균 대비 2σ 이상 상승?
□ 섹터 IPO 발행량이 전년 대비 급증?
□ P/E는 낮지만 변동성은 높은 상태? (P/E는 신뢰도 낮음)
→ 3개 이상 해당 시 버블 경보
```

---

## HFT와 시장 미시구조 (O'Hara 2015)

> **논문:** O'Hara (2015), *Journal of Financial Economics* — "High frequency market microstructure"

### 현대 시장 환경

```
2007년 이후 변화:
  미국: 11개 주식시장 + 50개+ 거래 시스템(다크풀) + 13개 옵션시장
  → 단일 거래소 → 고도로 분산화(fragmented)된 다중 거래소 체계

특성: "고도로 경쟁적, 고도로 분산화, 매우 빠름"
```

### HFT 속도 진화

```
1세대 (ms, 10⁻³초): 전통 전자 거래
2세대 (μs, 10⁻⁶초): 현재 HFT 주류
3세대 (ns, 10⁻⁹초): 극한 경쟁 구간

참고: 인간 시각 반응 시간 = 400~500ms
→ HFT는 인간이 눈을 깜빡이는 동안 수천 번 거래

SEC 통계:
  전체 취소 주문의 23%, 취소 호가의 38% → 50ms 이내 발생
```

### HFT 통계적 재정거래 복잡성

```
예시: GLD SPDR (금 ETF)
  금 ETF 1개 = 금 선물 + 13개 관련 상품
  → 91개 잠재 쌍(pairs)에 대해 동시 호가 필요

전통 시장조성 vs HFT 시장조성:
  전통: 단순 매수/매도 스프레드
  HFT: 91개+ 상관 자산의 가격 불일치를 실시간으로 찾고 닫음
```

### HFT 정보 구조

```
정보 비대칭 메커니즘:
  거래소 → HF 트레이더에게 자체 데이터 먼저 제공 (co-location)
  → 일반 투자자 대비 μs 단위 정보 선행

분산화의 역설:
  다수 거래소 = 가격 불일치 기회 증가
  But 전체 시장 유동성 분산 → 대형 주문 집행 어려움
  → Amihud 비유동성 지표가 시장 별로 달리 계산되어야 함
```

---

## Proof-of-Index (PoI): 온체인 금융 지수

> 전통 지수의 불투명성을 암호학적 검증으로 해결하는 블록체인 인프라

### 전통 지수의 한계

```
문제점:
  1. 중앙화 서버 → 외부 무결성 검증 불가
  2. 계산 과정 불투명 → 블랙박스
  3. 지수 제공자 신뢰 의존
  4. 정적(static) → 스마트 컨트랙트 자동화 불가
```

### PoI 4계층 아키텍처

```
Layer 1: 데이터 레이어 (Index Oracle)
  → 오프체인 데이터 수집 + SHA-256 해시 생성 → 블록체인 게시
  → Chainlink, RedStone, Pyth 등

Layer 2: 스마트 컨트랙트 레이어
  → 온체인에서 지수 값 계산 및 검증

Layer 3: 펀드/자산 레이어
  → 투자자 토큰 구매, NAV + 리밸런싱 규칙 코드화

Layer 4: 접근/통합 레이어
  → DeFi 프로토콜 연동 (대출, 파생상품 등)
```

**금융 지수의 진화:** 숫자 → 프로그래밍 가능한 금융 프리미티브(Programmable Financial Primitive)
