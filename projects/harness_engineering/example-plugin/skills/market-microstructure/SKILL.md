---
name: market-microstructure
description: |
  거래량 분석, 정보 비대칭, 가격 발견(price discovery), 시장 참여자 행동 분석,
  이상 거래량 탐지, ARCH/GARCH 변동성 모델링, 허딩 효과 분석,
  또는 "왜 거래가 일어나는가?" 관련 질문 시 활성화된다.
  단순 가격 추세 분석이나 포트폴리오 구성 작업에는 활성화하지 않는다.
version: 1.0.0
---

# 시장 미시구조 프레임워크

## 핵심 명제: 거래량이 먼저다

> "이걸 알 수 있는 방법은 가격이 아니라 거래량이다"

```
Volume = Private Information Extraction Score

거래량 급증 신호:
  20일 이동평균 대비 오늘 거래량 3배 or 5배 이상
  → 새로운 정보가 시장에 들어왔다는 신호

확인해야 하는 3가지:
  1. 정보가 좋은지 / 나쁜지 (방향)
  2. 영향력이 단기인지 / 장기인지 (지속성)
  3. 잡음(노이즈)인지 여부
```

**두 가지 해석 시나리오:**
- 거래량 폭증 = 새 정보 유입 (정보 보유자가 막 행동 시작)
- 거래량 폭증 = 고점 신호 (정보 보유자가 이미 행동 완료, 청산 중)
- → 가격 방향과 함께 판단 필수

---

## Rational Expectations와 거래의 역설

**핵심 질문:**
> "만약 모든 투자자가 동일한 정보를 가지면, 왜 거래가 이루어지나?"

```
Rational Expectation: 모든 이용가능한 정보 사용
→ 균형에서는 거래 동기가 없어야 함
But 실제로는 거래 발생 → 이유: Heterogeneous Expectations
```

**Heterogeneous Agents:**
- 거래량 증가 = 미래에 대한 기대가 다르다는 것
- 누군가는 팔고, 누군가는 산다 = 정보/해석의 차이
- 외국인이 삼성을 7만원에 매수 → 균형가격이 9만원인 걸 알기 때문 (정보 우위)

---

## ARCH 모델: 변동성의 시간 구조

```
어제의 변동성이 오늘의 변동성에 영향

ARCH: Auto Regressive Conditional Heteroskedasticity
  → 분산(리스크)에 시간 차원을 도입한 최초 방식
  → 다이나믹한 리스크: 정적 σ가 아닌 σ(t)

Yt = a·Yt-1 + εt
σt² = α₀ + α₁·εt-1²  (ARCH(1))
```

**실무 적용:**
- VaR 계산 시 ARCH 계열 사용 → 더 정확한 꼬리 리스크 추정
- 변동성이 낮은 구간 이후 변동성 급증 패턴 (변동성 클러스터링)

---

## 리스크 요인 분해 (실무)

```
개별 주식 리턴의 리스크 원천:

Index 리스크 (70-80%)
  → KOSPI, NASDAQ 등 국가/시장 인덱스
  → 인덱스 박스권 → 소형주 유리
  → 인덱스 상승 → 대형주(삼전, 하이닉스, ETF) 유리

Factor 리스크 (~20%)
  → PBR, 기업규모, EPS, 성장성
  → PBR 높은 기업 = 바이오/제조업 = 금리 민감

Macro 리스크 (나머지)
  → 거시경제 지표, 정책 변수 (Unit Root 주의)
```

---

## 허딩 효과

- 사람들은 왜 삼성전자를 좋아할까? → 사후적 설명만 가능, 사전 예측 어려움
- 가격 = 군중심리의 결과 → 진짜 균형가격이 아닐 수 있음
- 사람들은 자기 주장을 뒷받침하는 방향으로만 해석하는 경향

**대응:**
- ETF 수급(외국인/기관/개인 비율)으로 허딩 방향 파악
- 극단적 포지셔닝(AAII, COT 데이터) 역발상 신호

---

## 미래 예측의 3가지 레이어

```
1. 과거 통계 모형 (ARCH, ARIMA 등)      ← 데이터 기반
2. 산업적 변화 (기술 혁신, 구조 변화)    ← 섹터 분석
3. 경제학적 지식 (인과관계, 정책 효과)   ← 도메인 판단

→ 3가지를 동시에 고려해야 의미있는 예측
→ forecast는 반드시 경제학적 도메인에서 나와야 함
```

**기술적 분석(TA) 활용 기준:**
```python
# 피크-트로프 레이블링 (myTA.py 패턴)
# lag = period/2 윈도우로 로컬 고점/저점 탐지
# 매수=1 (로컬 저점), 매도=0 (로컬 고점), 보유=2

# 거래량 지표 우선순위
CMF (Chaikin Money Flow)  # 매집/분산 판단
MFI (Money Flow Index)    # 거래량 가중 RSI
Force Index               # 가격변화 × 거래량 = 힘
```
